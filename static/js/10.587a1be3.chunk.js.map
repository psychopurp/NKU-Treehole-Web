{"version":3,"sources":["utils/cookie.ts","config/axios.ts","api/userService.ts","components/CustomSnackBar/index.tsx","components/CustomSnackBar/index.module.less","components/Copyright/index.tsx","utils/store.ts","store/useUserModel.ts","pages/Register/index.module.less","pages/Register/index.tsx"],"names":["setToken","token","cookie","set","config","TOKEN_KEY","getToken","get","removeToken","remove","request","options","axios","defaults","headers","baseURL","interceptors","use","error","Promise","reject","response","console","log","data","code","AppConfig","LOGIN_EXPIRE","Error","msg","SUCCESS_CODE","resolve","setRequestMethod","method","apiUserLogin","a","url","apiUserRegister","CustomSnackBar","success","duration","autoHideDuration","anchorOrigin","vertical","horizontal","children","className","styles","root","icon","fontSize","severity","module","exports","Copyright","variant","color","align","href","LocalStore","setValue","key","value","localStorage","setItem","JSON","stringify","this","getValue","defaultValue","getItem","parse","removeValue","removeItem","USER_KEY","localUser","defaultUser","id","name","sex","birthday","avatar","level","createModel","useState","userInfo","setUserInfo","login","newUserInfo","logout","Register","form","useRef","email","password","userName","history","useHistory","notice","useNoticeService","userModel","useUserModel","useRequest","manual","onSuccess","params","type","snackBarOptions","push","onError","message","run","loading","open","backDrop","component","onSubmit","username","current","margin","required","fullWidth","label","autoComplete","onChange","event","target","submit","container","justify","item","onClick","mt"],"mappings":"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","file":"static/js/10.587a1be3.chunk.js","sourcesContent":["import cookie from \"js-cookie\";\nimport config from \"../config\";\n\nexport const setToken = (token: string) => cookie.set(config.TOKEN_KEY, token);\n\nexport const getToken: () => string = () => cookie.get(config.TOKEN_KEY) || \"\";\n\nexport const removeToken = () => cookie.remove(config.TOKEN_KEY);\n","import axios, { AxiosRequestConfig, AxiosError, AxiosResponse } from \"axios\";\nimport AppConfig from \".\";\nimport { getToken } from \"../utils/cookie\";\n\nexport interface ResponseData<T> {\n  code: number;\n  msg: string;\n  data: T;\n}\n\n// 指定 axios 请求类型\n\naxios.defaults.headers = {\n  \"Content-Type\": \"application/json;charset=utf-8\",\n};\n\naxios.defaults.baseURL = \"/api\";\n\n// 添加请求拦截器\naxios.interceptors.request.use(\n  (config: AxiosRequestConfig) => {\n    const token = getToken();\n    if (token) {\n      config.headers.token = token;\n    }\n\n    return config;\n  },\n  (error: AxiosError) => Promise.reject(error)\n);\n\n// 添加响应拦截器，拦截登录过期或者没有权限\naxios.interceptors.response.use(\n  (response: AxiosResponse<ResponseData<any>>) => {\n    console.log(response);\n    if (!response.data) {\n      return Promise.resolve(response);\n    }\n\n    // 登录已过期或者未登录\n    if (response.data.code === AppConfig.LOGIN_EXPIRE) {\n      //   Modal.confirm({\n      //     title: \"系统提示\",\n      //     content: response.data.msg,\n      //     okText: \"重新登录\",\n      //     onOk() {\n      //       store.dispatch(clearSideBarRoutes());\n      //       store.dispatch(logout());\n      //       window.location.href = `${\n      //         window.location.origin\n      //       }/react-ant-admin/system/login?redirectURL=${encodeURIComponent(\n      //         window.location.href\n      //       )}`;\n      //     },\n      //     onCancel() {},\n      //   });\n\n      return Promise.reject(new Error(response.data.msg));\n    }\n\n    // 请求成功\n    if (response.data.code === AppConfig.SUCCESS_CODE) {\n      return response.data as any;\n    }\n\n    // 请求成功，状态不为成功时\n    // message.error(response.data.msg);\n\n    return Promise.reject(new Error(response.data.msg));\n  },\n  (error: AxiosError) => {\n    // message.error(error.message);\n\n    return Promise.reject(error);\n  }\n);\n\n// 统一发起请求的函数\nexport default function request<T>(options: AxiosRequestConfig) {\n  return axios.request<T>(options);\n}\n","import { Method } from \"axios\";\nimport request from \"../config/axios\";\nimport { UserState } from \"../store/useUserModel\";\nimport { Utils } from \"../utils/func\";\n\n// interface PlainObject {}\n\nexport interface UserLoginData {\n  email: string; //邮箱\n  password: string;\n}\n\nexport interface UserRegisterData {\n  email: string; // 邮箱\n  password: string;\n  username: string;\n}\n\nexport const isMockEnv = () => false;\n\nexport const setRequestMethod = (method: Method): Method => {\n  if (isMockEnv()) {\n    return \"GET\";\n  }\n  return method;\n};\n\nexport async function apiUserLogin(data: UserLoginData) {\n  // await Utils.Sleep(500);\n  return request<UserState>({\n    method: setRequestMethod(\"POST\"),\n    url: \"/user/login\",\n    data: data,\n  });\n}\n\nexport async function apiUserRegister(data: UserRegisterData) {\n  // await Utils.Sleep(500);\n  return request<UserState>({\n    method: setRequestMethod(\"POST\"),\n    url: \"/user/register\",\n    data: data,\n  });\n}\n","import Alert from \"@material-ui/lab/Alert\";\nimport { SnackbarProps } from \"@material-ui/core\";\nimport CheckIcon from \"@material-ui/icons/Check\";\nimport styles from \"./index.module.less\";\n\nconst CustomSnackBar = (\n  msg: string = \"Success !\",\n  success: boolean = true,\n  duration: number = 600\n): SnackbarProps => {\n  return {\n    autoHideDuration: duration,\n    anchorOrigin: { vertical: \"bottom\", horizontal: \"center\" },\n    children: (\n      <div className={styles.root}>\n        <Alert\n          icon={<CheckIcon fontSize=\"inherit\" />}\n          severity={success ? \"success\" : \"error\"}\n        >\n          {msg}\n        </Alert>\n      </div>\n    ),\n  };\n};\n\nexport default CustomSnackBar;\n","// extracted by mini-css-extract-plugin\nmodule.exports = {\"root\":\"index_root__2hp4C\"};","import { Typography, Link } from \"@material-ui/core\";\n\nexport default function Copyright() {\n  return (\n    <Typography variant=\"body2\" color=\"textSecondary\" align=\"center\">\n      {\"Copyright © \"}\n      <Link color=\"inherit\" href=\"#\">\n        南开树洞\n      </Link>\n      {\" 2021.\"}\n    </Typography>\n  );\n}\n","function stringfy(value: any): string {\n  return JSON.stringify(value);\n}\n\nfunction parse<T>(value: string): T | null {\n  try {\n    return JSON.parse(value) as T;\n  } catch (error) {\n    return null;\n  }\n}\n\n// 本地持久化管理\nexport interface ILocalStore {\n  setValue(key: string, data: any): ILocalStore;\n  getValue<T>(key: string, defaultValue?: T): T | null;\n  removeValue(key: string): ILocalStore;\n}\n\nconst LocalStore: ILocalStore = {\n  setValue(key: string, data: any): ILocalStore {\n    localStorage.setItem(key, stringfy(data));\n    return this;\n  },\n\n  getValue<T>(key: string, defaultValue?: T): T | null {\n    const value = localStorage.getItem(key);\n    if (!value) return defaultValue || null;\n    const data = parse<T>(value);\n    return data;\n  },\n\n  removeValue(key: string): ILocalStore {\n    localStorage.removeItem(key);\n    return this;\n  },\n};\n\nexport default LocalStore;\n","import { useState } from \"react\";\nimport { getToken, setToken, removeToken } from \"../utils/cookie\";\nimport LocalStore from \"../utils/store\";\nimport { createModel } from \"hox\";\n\nexport interface User {\n  id: string;\n  name: string;\n  sex: string;\n  birthday?: string | null;\n  avatar: string | null;\n  phone?: string;\n  level: number;\n}\n\nexport interface UserState extends User {\n  token: string;\n}\n\nconst USER_KEY = \"NKU-Treehole-User\";\n\nconst localUser = LocalStore.getValue<UserState>(USER_KEY) || {};\n\nconst defaultUser: UserState = {\n  id: \"0\",\n  name: \"cactus\",\n  sex: \"男\",\n  birthday: null,\n  avatar: \"\",\n  level: 0,\n  token: getToken(),\n  ...localUser,\n};\n\nfunction useUser() {\n  const [userInfo, setUserInfo] = useState<UserState>({\n    ...defaultUser,\n  });\n\n  const login = (newUserInfo: UserState) => {\n    setToken(newUserInfo.token);\n    LocalStore.setValue(USER_KEY, newUserInfo);\n    setUserInfo(newUserInfo);\n  };\n\n  const logout = () => {\n    removeToken();\n    LocalStore.removeValue(USER_KEY);\n    setUserInfo({ ...defaultUser });\n  };\n\n  return {\n    userInfo,\n    login,\n    logout,\n  };\n}\n\nexport default createModel(useUser);\n","// extracted by mini-css-extract-plugin\nmodule.exports = {\"root\":\"index_root__2CXW3\",\"backDrop\":\"index_backDrop__3N-p-\",\"avatar\":\"index_avatar__jtiTo\",\"form\":\"index_form__2fLGB\",\"submit\":\"index_submit__17L12\"};","import {\n  Avatar,\n  Backdrop,\n  Box,\n  Button,\n  CircularProgress,\n  Grid,\n  Link,\n  TextField,\n  Typography,\n} from \"@material-ui/core\";\nimport styles from \"./index.module.less\";\nimport LockOutlinedIcon from \"@material-ui/icons/LockOutlined\";\nimport { useRef } from \"react\";\nimport { useHistory } from \"react-router-dom\";\nimport Copyright from \"../../components/Copyright\";\nimport { useNoticeService } from \"../../components/NoticeService\";\nimport useUserModel from \"../../store/useUserModel\";\nimport { useRequest } from \"ahooks\";\nimport CustomSnackBar from \"../../components/CustomSnackBar\";\nimport { apiUserRegister, UserLoginData } from \"../../api/userService\";\n\ninterface InputForm {\n  email: string;\n  password: string;\n  userName: string;\n}\n\nconst Register: React.FC = () => {\n  const form = useRef<InputForm>({ email: \"\", password: \"\", userName: \"\" });\n  const history = useHistory();\n  const notice = useNoticeService();\n  const userModel = useUserModel();\n  const { run, loading } = useRequest(apiUserRegister, {\n    manual: true,\n    onSuccess: ({ data }, params: [data: UserLoginData]) => {\n      userModel.login(data);\n      notice({\n        type: \"SnackBar\",\n        snackBarOptions: CustomSnackBar(data.name),\n      });\n\n      history.push(\"/index/home\");\n    },\n    onError: (error) => {\n      console.log(error);\n      notice({\n        type: \"SnackBar\",\n        snackBarOptions: { ...CustomSnackBar(error.message, false) },\n      });\n    },\n  });\n\n  const onClick = () => {\n    run({\n      username: form.current.userName,\n      email: form.current.email,\n      password: form.current.password,\n    });\n  };\n\n  return (\n    <div className={styles.root}>\n      <Backdrop open={loading} className={styles.backDrop}>\n        <CircularProgress />\n      </Backdrop>\n      <Avatar className={styles.avatar}>\n        <LockOutlinedIcon />\n      </Avatar>\n      <Typography component=\"h1\" variant=\"h5\">\n        Sign up\n      </Typography>\n\n      <form className={styles.form} onSubmit={onClick}>\n        <TextField\n          variant=\"outlined\"\n          margin=\"normal\"\n          required\n          fullWidth\n          id=\"userName\"\n          label=\"Username\"\n          autoComplete=\"Username\"\n          onChange={(event) => {\n            form.current.userName = event.target.value;\n          }}\n        />\n        <TextField\n          variant=\"outlined\"\n          margin=\"normal\"\n          required\n          fullWidth\n          id=\"email\"\n          label=\"Email Address\"\n          autoComplete=\"email\"\n          onChange={(event) => {\n            form.current.email = event.target.value;\n          }}\n        />\n        <TextField\n          variant=\"outlined\"\n          margin=\"normal\"\n          required\n          fullWidth\n          label=\"Password\"\n          type=\"password\"\n          id=\"password\"\n          autoComplete=\"current-password\"\n          onChange={(event) => {\n            form.current.password = event.target.value;\n          }}\n        />\n\n        <Button\n          type=\"submit\"\n          fullWidth\n          variant=\"contained\"\n          color=\"primary\"\n          className={styles.submit}\n          // onClick={onClick}\n        >\n          Sign Up\n        </Button>\n\n        <Grid container justify=\"flex-end\">\n          <Grid item>\n            <Link\n              component=\"button\"\n              variant=\"body2\"\n              onClick={() => {\n                history.push(\"/system/login\");\n              }}\n            >\n              {\"Already have an account? Sign in\"}\n            </Link>\n          </Grid>\n        </Grid>\n      </form>\n\n      <Box mt={5}>\n        <Copyright />\n      </Box>\n    </div>\n  );\n};\n\nexport default Register;\n"],"sourceRoot":""}