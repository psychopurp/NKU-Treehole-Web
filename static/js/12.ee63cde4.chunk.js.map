{"version":3,"sources":["utils/cookie.ts","config/axios.ts","api/userService.ts","components/CustomSnackBar/index.tsx","components/CustomSnackBar/index.module.less","components/Copyright/index.tsx","utils/store.ts","store/useUserModel.ts","../node_modules/_@material-ui_core@4.11.4@@material-ui/core/esm/styles/createStyles.js","pages/Login/index.tsx"],"names":["setToken","token","cookie","set","config","TOKEN_KEY","getToken","get","removeToken","remove","request","options","axios","defaults","headers","baseURL","interceptors","use","error","Promise","reject","response","console","log","data","code","AppConfig","LOGIN_EXPIRE","Error","msg","SUCCESS_CODE","resolve","setRequestMethod","method","apiUserLogin","a","url","apiUserRegister","CustomSnackBar","success","duration","autoHideDuration","anchorOrigin","vertical","horizontal","children","className","styles","root","icon","fontSize","severity","module","exports","Copyright","variant","color","align","href","LocalStore","setValue","key","value","localStorage","setItem","JSON","stringify","this","getValue","defaultValue","getItem","parse","removeValue","removeItem","USER_KEY","localUser","defaultUser","id","name","sex","birthday","avatar","level","createModel","useState","userInfo","setUserInfo","login","newUserInfo","logout","createStyles","useStyles","makeStyles","palette","spacing","zIndex","margin","backgroundColor","primary","main","form","width","marginTop","submit","paper","display","flexDirection","alignItems","backDrop","drawer","Login","classes","history","useHistory","notice","useNoticeService","userModel","useUserModel","useRef","email","password","useRequest","manual","onSuccess","params","type","snackBarOptions","push","onError","message","run","loading","open","component","onSubmit","current","required","fullWidth","label","autoComplete","onChange","event","target","container","item","xs","onClick","mt"],"mappings":"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","file":"static/js/12.ee63cde4.chunk.js","sourcesContent":["import cookie from \"js-cookie\";\nimport config from \"../config\";\n\nexport const setToken = (token: string) => cookie.set(config.TOKEN_KEY, token);\n\nexport const getToken: () => string = () => cookie.get(config.TOKEN_KEY) || \"\";\n\nexport const removeToken = () => cookie.remove(config.TOKEN_KEY);\n","import axios, { AxiosRequestConfig, AxiosError, AxiosResponse } from \"axios\";\nimport AppConfig from \".\";\nimport { getToken } from \"../utils/cookie\";\n\nexport interface ResponseData<T> {\n  code: number;\n  msg: string;\n  data: T;\n}\n\n// 指定 axios 请求类型\n\naxios.defaults.headers = {\n  \"Content-Type\": \"application/json;charset=utf-8\",\n};\n\naxios.defaults.baseURL = \"/api\";\n\n// 添加请求拦截器\naxios.interceptors.request.use(\n  (config: AxiosRequestConfig) => {\n    const token = getToken();\n    if (token) {\n      config.headers.token = token;\n    }\n\n    return config;\n  },\n  (error: AxiosError) => Promise.reject(error)\n);\n\n// 添加响应拦截器，拦截登录过期或者没有权限\naxios.interceptors.response.use(\n  (response: AxiosResponse<ResponseData<any>>) => {\n    console.log(response);\n    if (!response.data) {\n      return Promise.resolve(response);\n    }\n\n    // 登录已过期或者未登录\n    if (response.data.code === AppConfig.LOGIN_EXPIRE) {\n      //   Modal.confirm({\n      //     title: \"系统提示\",\n      //     content: response.data.msg,\n      //     okText: \"重新登录\",\n      //     onOk() {\n      //       store.dispatch(clearSideBarRoutes());\n      //       store.dispatch(logout());\n      //       window.location.href = `${\n      //         window.location.origin\n      //       }/react-ant-admin/system/login?redirectURL=${encodeURIComponent(\n      //         window.location.href\n      //       )}`;\n      //     },\n      //     onCancel() {},\n      //   });\n\n      return Promise.reject(new Error(response.data.msg));\n    }\n\n    // 请求成功\n    if (response.data.code === AppConfig.SUCCESS_CODE) {\n      return response.data as any;\n    }\n\n    // 请求成功，状态不为成功时\n    // message.error(response.data.msg);\n\n    return Promise.reject(new Error(response.data.msg));\n  },\n  (error: AxiosError) => {\n    // message.error(error.message);\n\n    return Promise.reject(error);\n  }\n);\n\n// 统一发起请求的函数\nexport default function request<T>(options: AxiosRequestConfig) {\n  return axios.request<T>(options);\n}\n","import { Method } from \"axios\";\nimport request from \"../config/axios\";\nimport { UserState } from \"../store/useUserModel\";\nimport { Utils } from \"../utils/func\";\n\n// interface PlainObject {}\n\nexport interface UserLoginData {\n  email: string; //邮箱\n  password: string;\n}\n\nexport interface UserRegisterData {\n  email: string; // 邮箱\n  password: string;\n  username: string;\n}\n\nexport const isMockEnv = () => false;\n\nexport const setRequestMethod = (method: Method): Method => {\n  if (isMockEnv()) {\n    return \"GET\";\n  }\n  return method;\n};\n\nexport async function apiUserLogin(data: UserLoginData) {\n  // await Utils.Sleep(500);\n  return request<UserState>({\n    method: setRequestMethod(\"POST\"),\n    url: \"/user/login\",\n    data: data,\n  });\n}\n\nexport async function apiUserRegister(data: UserRegisterData) {\n  // await Utils.Sleep(500);\n  return request<UserState>({\n    method: setRequestMethod(\"POST\"),\n    url: \"/user/register\",\n    data: data,\n  });\n}\n","import Alert from \"@material-ui/lab/Alert\";\nimport { SnackbarProps } from \"@material-ui/core\";\nimport CheckIcon from \"@material-ui/icons/Check\";\nimport styles from \"./index.module.less\";\n\nconst CustomSnackBar = (\n  msg: string = \"Success !\",\n  success: boolean = true,\n  duration: number = 600\n): SnackbarProps => {\n  return {\n    autoHideDuration: duration,\n    anchorOrigin: { vertical: \"bottom\", horizontal: \"center\" },\n    children: (\n      <div className={styles.root}>\n        <Alert\n          icon={<CheckIcon fontSize=\"inherit\" />}\n          severity={success ? \"success\" : \"error\"}\n        >\n          {msg}\n        </Alert>\n      </div>\n    ),\n  };\n};\n\nexport default CustomSnackBar;\n","// extracted by mini-css-extract-plugin\nmodule.exports = {\"root\":\"index_root__2hp4C\"};","import { Typography, Link } from \"@material-ui/core\";\n\nexport default function Copyright() {\n  return (\n    <Typography variant=\"body2\" color=\"textSecondary\" align=\"center\">\n      {\"Copyright © \"}\n      <Link color=\"inherit\" href=\"#\">\n        南开树洞\n      </Link>\n      {\" 2021.\"}\n    </Typography>\n  );\n}\n","function stringfy(value: any): string {\n  return JSON.stringify(value);\n}\n\nfunction parse<T>(value: string): T | null {\n  try {\n    return JSON.parse(value) as T;\n  } catch (error) {\n    return null;\n  }\n}\n\n// 本地持久化管理\nexport interface ILocalStore {\n  setValue(key: string, data: any): ILocalStore;\n  getValue<T>(key: string, defaultValue?: T): T | null;\n  removeValue(key: string): ILocalStore;\n}\n\nconst LocalStore: ILocalStore = {\n  setValue(key: string, data: any): ILocalStore {\n    localStorage.setItem(key, stringfy(data));\n    return this;\n  },\n\n  getValue<T>(key: string, defaultValue?: T): T | null {\n    const value = localStorage.getItem(key);\n    if (!value) return defaultValue || null;\n    const data = parse<T>(value);\n    return data;\n  },\n\n  removeValue(key: string): ILocalStore {\n    localStorage.removeItem(key);\n    return this;\n  },\n};\n\nexport default LocalStore;\n","import { useState } from \"react\";\nimport { getToken, setToken, removeToken } from \"../utils/cookie\";\nimport LocalStore from \"../utils/store\";\nimport { createModel } from \"hox\";\n\nexport interface User {\n  id: string;\n  name: string;\n  sex: string;\n  birthday?: string | null;\n  avatar: string | null;\n  phone?: string;\n  level: number;\n}\n\nexport interface UserState extends User {\n  token: string;\n}\n\nconst USER_KEY = \"NKU-Treehole-User\";\n\nconst localUser = LocalStore.getValue<UserState>(USER_KEY) || {};\n\nconst defaultUser: UserState = {\n  id: \"0\",\n  name: \"cactus\",\n  sex: \"男\",\n  birthday: null,\n  avatar: \"\",\n  level: 0,\n  token: getToken(),\n  ...localUser,\n};\n\nfunction useUser() {\n  const [userInfo, setUserInfo] = useState<UserState>({\n    ...defaultUser,\n  });\n\n  const login = (newUserInfo: UserState) => {\n    setToken(newUserInfo.token);\n    LocalStore.setValue(USER_KEY, newUserInfo);\n    setUserInfo(newUserInfo);\n  };\n\n  const logout = () => {\n    removeToken();\n    LocalStore.removeValue(USER_KEY);\n    setUserInfo({ ...defaultUser });\n  };\n\n  return {\n    userInfo,\n    login,\n    logout,\n  };\n}\n\nexport default createModel(useUser);\n","import { createStyles as createStylesOriginal } from '@material-ui/styles'; // let warnOnce = false;\n// To remove in v5\n\nexport default function createStyles(styles) {\n  // warning(\n  //   warnOnce,\n  //   [\n  //     'Material-UI: createStyles from @material-ui/core/styles is deprecated.',\n  //     'Please use @material-ui/styles/createStyles',\n  //   ].join('\\n'),\n  // );\n  // warnOnce = true;\n  return createStylesOriginal(styles);\n}","import {\n  Grid,\n  Avatar,\n  Typography,\n  TextField,\n  Button,\n  Link,\n  Box,\n  Backdrop,\n  CircularProgress,\n} from \"@material-ui/core\";\nimport LockOutlinedIcon from \"@material-ui/icons/LockOutlined\";\nimport { createStyles, makeStyles, Theme } from \"@material-ui/core/styles\";\nimport { useHistory } from \"react-router-dom\";\nimport { useRef } from \"react\";\nimport { apiUserLogin, UserLoginData } from \"../../api/userService\";\nimport useUserModel from \"../../store/useUserModel\";\nimport { useRequest } from \"ahooks\";\nimport { useNoticeService } from \"../../components/NoticeService\";\nimport CustomSnackBar from \"../../components/CustomSnackBar\";\nimport Copyright from \"../../components/Copyright\";\n\nconst useStyles = makeStyles(({ palette, spacing, zIndex }: Theme) =>\n  createStyles({\n    avatar: {\n      margin: spacing(1),\n      backgroundColor: palette.primary.main,\n    },\n    form: {\n      width: \"100%\", // Fix IE 11 issue.\n      marginTop: spacing(1),\n      // backgroundColor: \"yellow\",\n    },\n    submit: {\n      margin: spacing(3, 0, 2),\n    },\n    paper: {\n      margin: spacing(8, 3),\n      display: \"flex\",\n      flexDirection: \"column\",\n      alignItems: \"center\",\n    },\n\n    backDrop: {\n      zIndex: zIndex.drawer + 1,\n    },\n  })\n);\n\ninterface InputForm {\n  email: string;\n  password: string;\n}\n\nconst Login: React.FC = () => {\n  const classes = useStyles();\n  const history = useHistory();\n  const notice = useNoticeService();\n  const userModel = useUserModel();\n  const form = useRef<InputForm>({ email: \"\", password: \"\" });\n  const { run, loading } = useRequest(apiUserLogin, {\n    manual: true,\n    onSuccess: ({ data }, params: [data: UserLoginData]) => {\n      userModel.login(data);\n      notice({\n        type: \"SnackBar\",\n        snackBarOptions: CustomSnackBar(),\n      });\n\n      history.push(\"/index/home\");\n    },\n    onError: (error) => {\n      console.log(error);\n      notice({\n        type: \"SnackBar\",\n        snackBarOptions: { ...CustomSnackBar(error.message, false) },\n      });\n    },\n  });\n\n  const onClick = () => {\n    run({\n      email: form.current.email,\n      password: form.current.password,\n    });\n  };\n\n  return (\n    <div className={classes.paper}>\n      <Backdrop open={loading} className={classes.backDrop}>\n        <CircularProgress />\n      </Backdrop>\n      <Avatar className={classes.avatar}>\n        <LockOutlinedIcon />\n      </Avatar>\n      <Typography component=\"h1\" variant=\"h5\">\n        Sign in\n      </Typography>\n\n      <form className={classes.form} onSubmit={onClick}>\n        <TextField\n          variant=\"outlined\"\n          margin=\"normal\"\n          required\n          fullWidth\n          id=\"email\"\n          label=\"Email Address\"\n          autoComplete=\"email\"\n          onChange={(event) => {\n            form.current.email = event.target.value;\n          }}\n        />\n        <TextField\n          variant=\"outlined\"\n          margin=\"normal\"\n          required\n          fullWidth\n          label=\"Password\"\n          type=\"password\"\n          id=\"password\"\n          autoComplete=\"current-password\"\n          onChange={(event) => {\n            form.current.password = event.target.value;\n          }}\n        />\n        <Button\n          type=\"submit\"\n          fullWidth\n          variant=\"contained\"\n          color=\"primary\"\n          className={classes.submit}\n        >\n          Sign In\n        </Button>\n\n        <Grid container>\n          <Grid item xs>\n            <Link\n              component=\"button\"\n              variant=\"body2\"\n              onClick={() => {\n                history.push(\"/welcome\");\n              }}\n            >\n              Forgot password?\n            </Link>\n          </Grid>\n          <Grid item>\n            <Link\n              component=\"button\"\n              variant=\"body2\"\n              onClick={() => {\n                history.push(\"/system/register\");\n              }}\n            >\n              {\"Don't have an account? Sign Up\"}\n            </Link>\n          </Grid>\n        </Grid>\n      </form>\n\n      <Box mt={5}>\n        <Copyright />{\" \"}\n      </Box>\n    </div>\n  );\n};\n\nexport default Login;\n"],"sourceRoot":""}