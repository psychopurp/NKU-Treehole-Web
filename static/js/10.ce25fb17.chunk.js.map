{"version":3,"sources":["utils/cookie.ts","components/CustomSnackBar/index.module.less","config/axios.ts","utils/func.ts","api/userService.ts","utils/store.ts","store/useUserModel.ts","components/CustomSnackBar/index.tsx","pages/Login/index.tsx"],"names":["setToken","token","cookie","set","config","TOKEN_KEY","getToken","get","removeToken","remove","module","exports","request","options","axios","defaults","headers","baseURL","AppConfig","API_URL","interceptors","use","error","Promise","reject","response","console","log","data","code","LOGIN_EXPIRE","Error","msg","SUCCESS_CODE","resolve","Utils","Sleep","ms","a","setTimeout","apiUserLogin","method","url","LocalStore","setValue","key","value","localStorage","setItem","JSON","stringify","this","getValue","defaultValue","getItem","parse","removeValue","removeItem","USER_KEY","localUser","defaultUser","id","name","sex","birthday","avatar","phone","level","createModel","useState","userInfo","setUserInfo","login","newUserInfo","logout","CustomSnackBar","duration","autoHideDuration","anchorOrigin","vertical","horizontal","children","className","styles","root","Alert","icon","fontSize","severity","useStyles","makeStyles","palette","spacing","zIndex","createStyles","margin","backgroundColor","primary","main","form","width","marginTop","submit","paper","display","flexDirection","alignItems","backDrop","drawer","Login","classes","history","useHistory","notice","useNoticeService","userModel","useUserModel","useRef","email","password","useRequest","manual","onSuccess","params","type","snackBarOptions","onError","message","loading","run","Backdrop","open","CircularProgress","Avatar","Typography","component","variant","TextField","required","fullWidth","label","autoComplete","onChange","event","current","target","Button","color","onClick","push","Grid","container","item","xs","Link","Box","mt","Copyright","align","href"],"mappings":"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","file":"static/js/10.ce25fb17.chunk.js","sourcesContent":["import cookie from \"js-cookie\";\nimport config from \"../config\";\n\nexport const setToken = (token: string) => cookie.set(config.TOKEN_KEY, token);\n\nexport const getToken: () => string = () => cookie.get(config.TOKEN_KEY) || \"\";\n\nexport const removeToken = () => cookie.remove(config.TOKEN_KEY);\n","// extracted by mini-css-extract-plugin\nmodule.exports = {\"root\":\"index_root__2hp4C\"};","import axios, { AxiosRequestConfig, AxiosError, AxiosResponse } from \"axios\";\nimport AppConfig from \".\";\nimport { getToken } from \"../utils/cookie\";\n\nexport interface ResponseData<T> {\n  code: number;\n  msg: string;\n  data: T;\n}\n\n// 指定 axios 请求类型\n\naxios.defaults.headers = {\n  \"Content-Type\": \"application/json;charset=utf-8\",\n};\n\naxios.defaults.baseURL =\n  process.env.NODE_ENV === \"production\"\n    ? AppConfig.API_URL\n    : \"http://localhost:9000/\";\n\n// 添加请求拦截器\naxios.interceptors.request.use(\n  (config: AxiosRequestConfig) => {\n    const token = getToken();\n    if (token) {\n      config.headers.token = token;\n    }\n\n    return config;\n  },\n  (error: AxiosError) => Promise.reject(error)\n);\n\n// 添加响应拦截器，拦截登录过期或者没有权限\naxios.interceptors.response.use(\n  (response: AxiosResponse<ResponseData<any>>) => {\n    console.log(response);\n    if (!response.data) {\n      return Promise.resolve(response);\n    }\n\n    // 登录已过期或者未登录\n    if (response.data.code === AppConfig.LOGIN_EXPIRE) {\n      //   Modal.confirm({\n      //     title: \"系统提示\",\n      //     content: response.data.msg,\n      //     okText: \"重新登录\",\n      //     onOk() {\n      //       store.dispatch(clearSideBarRoutes());\n      //       store.dispatch(logout());\n      //       window.location.href = `${\n      //         window.location.origin\n      //       }/react-ant-admin/system/login?redirectURL=${encodeURIComponent(\n      //         window.location.href\n      //       )}`;\n      //     },\n      //     onCancel() {},\n      //   });\n\n      return Promise.reject(new Error(response.data.msg));\n    }\n\n    // 请求成功\n    if (response.data.code === AppConfig.SUCCESS_CODE) {\n      return response.data as any;\n    }\n\n    // 请求成功，状态不为成功时\n    // message.error(response.data.msg);\n\n    return Promise.reject(new Error(response.data.msg));\n  },\n  (error: AxiosError) => {\n    // message.error(error.message);\n\n    return Promise.reject(error);\n  }\n);\n\n// 统一发起请求的函数\nexport default function request<T>(options: AxiosRequestConfig) {\n  return axios.request<T>(options);\n}\n","export const Utils = {\n  Sleep: async (ms: number) => {\n    return new Promise((resolve) => {\n      setTimeout(() => {\n        resolve(\"\");\n      }, ms);\n    });\n  },\n};\n","import { Method } from \"axios\";\nimport request from \"../config/axios\";\nimport { UserState } from \"../store/useUserModel\";\nimport { Utils } from \"../utils/func\";\n\n// interface PlainObject {}\n\nexport interface UserLoginData {\n  account: string; //手机号或者邮箱\n  password: string;\n}\n\nexport const isMockEnv = () => process.env.NODE_ENV !== \"production\";\n\nexport const setRequestMethod = (method: Method): Method => {\n  if (isMockEnv()) {\n    return \"GET\";\n  }\n  return method;\n};\n\nexport async function apiUserLogin(data: UserLoginData) {\n  await Utils.Sleep(500);\n  return request<UserState>({\n    method: setRequestMethod(\"POST\"),\n    url: \"/user/login\",\n    data: data,\n  });\n}\n","function stringfy(value: any): string {\n  return JSON.stringify(value);\n}\n\nfunction parse<T>(value: string): T | null {\n  try {\n    return JSON.parse(value) as T;\n  } catch (error) {\n    return null;\n  }\n}\n\n// 本地持久化管理\nexport interface ILocalStore {\n  setValue(key: string, data: any): ILocalStore;\n  getValue<T>(key: string, defaultValue?: T): T | null;\n  removeValue(key: string): ILocalStore;\n}\n\nconst LocalStore: ILocalStore = {\n  setValue(key: string, data: any): ILocalStore {\n    localStorage.setItem(key, stringfy(data));\n    return this;\n  },\n\n  getValue<T>(key: string, defaultValue?: T): T | null {\n    const value = localStorage.getItem(key);\n    if (!value) return defaultValue || null;\n    const data = parse<T>(value);\n    return data;\n  },\n\n  removeValue(key: string): ILocalStore {\n    localStorage.removeItem(key);\n    return this;\n  },\n};\n\nexport default LocalStore;\n","import { useState } from \"react\";\nimport { getToken, setToken, removeToken } from \"../utils/cookie\";\nimport LocalStore from \"../utils/store\";\nimport { createModel } from \"hox\";\n\nexport interface User {\n  id: string;\n  name: string;\n  sex: string;\n  birthday?: string | null;\n  avatar: string | null;\n  phone: string;\n  level: number;\n}\n\nexport interface UserState extends User {\n  token: string;\n}\n\nconst USER_KEY = \"NKU-Treehole-User\";\n\nconst localUser = LocalStore.getValue<UserState>(USER_KEY) || {};\n\nconst defaultUser: UserState = {\n  id: \"0\",\n  name: \"cactus\",\n  sex: \"男\",\n  birthday: null,\n  avatar: \"\",\n  phone: \"\",\n  level: 0,\n  token: getToken(),\n  ...localUser,\n};\n\nfunction useUser() {\n  const [userInfo, setUserInfo] = useState<UserState>({\n    ...defaultUser,\n  });\n\n  const login = (newUserInfo: UserState) => {\n    setToken(newUserInfo.token);\n    LocalStore.setValue(USER_KEY, newUserInfo);\n    setUserInfo(newUserInfo);\n  };\n\n  const logout = () => {\n    removeToken();\n    LocalStore.removeValue(USER_KEY);\n    setUserInfo({ ...defaultUser });\n  };\n\n  return {\n    userInfo,\n    login,\n    logout,\n  };\n}\n\nexport default createModel(useUser);\n","import Alert from \"@material-ui/lab/Alert\";\nimport { SnackbarProps } from \"@material-ui/core\";\nimport CheckIcon from \"@material-ui/icons/Check\";\nimport styles from \"./index.module.less\";\n\nconst CustomSnackBar = (\n  msg: string = \"Success !\",\n  duration: number = 600\n): SnackbarProps => {\n  return {\n    autoHideDuration: duration,\n    anchorOrigin: { vertical: \"bottom\", horizontal: \"center\" },\n    children: (\n      <div className={styles.root}>\n        <Alert icon={<CheckIcon fontSize=\"inherit\" />} severity=\"success\">\n          {msg}\n        </Alert>\n      </div>\n    ),\n  };\n};\n\nexport default CustomSnackBar;\n","import {\n  Grid,\n  Avatar,\n  Typography,\n  TextField,\n  Button,\n  Link,\n  Box,\n  Backdrop,\n  CircularProgress,\n} from \"@material-ui/core\";\nimport LockOutlinedIcon from \"@material-ui/icons/LockOutlined\";\nimport { createStyles, makeStyles, Theme } from \"@material-ui/core/styles\";\nimport { useHistory } from \"react-router-dom\";\nimport { useRef } from \"react\";\nimport { apiUserLogin, UserLoginData } from \"../../api/userService\";\nimport useUserModel from \"../../store/useUserModel\";\nimport { useRequest } from \"ahooks\";\nimport { useNoticeService } from \"../../components/NoticeService\";\nimport CustomSnackBar from \"../../components/CustomSnackBar\";\n\nconst useStyles = makeStyles(({ palette, spacing, zIndex }: Theme) =>\n  createStyles({\n    avatar: {\n      margin: spacing(1),\n      backgroundColor: palette.primary.main,\n    },\n    form: {\n      width: \"100%\", // Fix IE 11 issue.\n      marginTop: spacing(1),\n      // backgroundColor: \"yellow\",\n    },\n    submit: {\n      margin: spacing(3, 0, 2),\n    },\n    paper: {\n      margin: spacing(8, 3),\n      display: \"flex\",\n      flexDirection: \"column\",\n      alignItems: \"center\",\n    },\n\n    backDrop: {\n      zIndex: zIndex.drawer + 1,\n    },\n  })\n);\n\ninterface InputForm {\n  email: string;\n  password: string;\n}\n\nconst Login: React.FC = () => {\n  const classes = useStyles();\n  const history = useHistory();\n  const notice = useNoticeService();\n\n  const userModel = useUserModel();\n  const form = useRef<InputForm>({ email: \"\", password: \"\" });\n  const { run, loading } = useRequest(apiUserLogin, {\n    manual: true,\n    onSuccess: ({ data }, params: [data: UserLoginData]) => {\n      // console.log(data, params);\n      userModel.login(data);\n      notice({\n        type: \"SnackBar\",\n        snackBarOptions: CustomSnackBar(data.name),\n      });\n\n      // history.push(\"/home\");\n    },\n    onError: (error) => {\n      console.log(error);\n      notice({\n        type: \"SnackBar\",\n        snackBarOptions: { ...CustomSnackBar(error.message) },\n      });\n    },\n  });\n\n  const onClick = () => {\n    history.push(\"/home\");\n\n    // run({\n    //   account: form.current.email,\n    //   password: form.current.password,\n    // });\n  };\n\n  return (\n    <div className={classes.paper}>\n      <Backdrop open={loading} className={classes.backDrop}>\n        <CircularProgress />\n      </Backdrop>\n      <Avatar className={classes.avatar}>\n        <LockOutlinedIcon />\n      </Avatar>\n      <Typography component=\"h1\" variant=\"h5\">\n        Sign in\n      </Typography>\n\n      <div className={classes.form}>\n        <TextField\n          variant=\"outlined\"\n          margin=\"normal\"\n          required\n          fullWidth\n          id=\"email\"\n          label=\"Email Address\"\n          autoComplete=\"email\"\n          onChange={(event) => {\n            form.current.email = event.target.value;\n          }}\n        />\n        <TextField\n          variant=\"outlined\"\n          margin=\"normal\"\n          required\n          fullWidth\n          label=\"Password\"\n          type=\"password\"\n          id=\"password\"\n          autoComplete=\"current-password\"\n          onChange={(event) => {\n            form.current.password = event.target.value;\n          }}\n        />\n        <Button\n          fullWidth\n          variant=\"contained\"\n          color=\"primary\"\n          className={classes.submit}\n          onClick={onClick}\n        >\n          Sign In\n        </Button>\n\n        <Grid container>\n          <Grid item xs>\n            <Link\n              component=\"button\"\n              variant=\"body2\"\n              onClick={() => {\n                history.push(\"/welcome\");\n              }}\n            >\n              Forgot password?\n            </Link>\n          </Grid>\n          <Grid item>\n            <Link\n              component=\"button\"\n              variant=\"body2\"\n              onClick={() => {\n                history.push(\"/system/register\");\n              }}\n            >\n              {\"Don't have an account? Sign Up\"}\n            </Link>\n          </Grid>\n        </Grid>\n      </div>\n\n      <Box mt={5}>\n        <Copyright />{\" \"}\n      </Box>\n    </div>\n  );\n};\n\nexport default Login;\n\nfunction Copyright() {\n  return (\n    <Typography variant=\"body2\" color=\"textSecondary\" align=\"center\">\n      {\"Copyright © \"}\n      <Link color=\"inherit\" href=\"#\">\n        南开树洞\n      </Link>\n      {\" 2021.\"}\n    </Typography>\n  );\n}\n"],"sourceRoot":""}